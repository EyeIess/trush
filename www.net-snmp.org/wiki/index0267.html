

<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=Debugger&printable=yes by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:28:20 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>Debugger - Net-SNMP Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"Debugger","wgTitle":"Debugger","wgCurRevisionId":5728,"wgRevisionId":5728,"wgArticleId":1625,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":!1,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Debugger","wgRelevantArticleId":1625,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="load531d.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;printable=1&amp;skin=monobook" />
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="loadf198.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;printable=1&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.26.3" />
<meta name="robots" content="noindex,follow" />
<link rel="shortcut icon" href="../favicon.html" />
<link rel="search" type="application/opensearchdescription+xml" href="opensearch_desc.php" title="Net-SNMP Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="api251f.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Net-SNMP Wiki Atom feed" href="apidf90.php?title=Special:RecentChanges&amp;feed=atom" />
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Debugger skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">Debugger</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Net-SNMP Wiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#Debugging_Net-SNMP_Applications"><span class="tocnumber">1</span> <span class="toctext">Debugging Net-SNMP Applications</span></a></li>
<li class="toclevel-1 tocsection-2"><a href="#GDB_.2F_DDD"><span class="tocnumber">2</span> <span class="toctext">GDB / DDD</span></a>
<ul>
<li class="toclevel-2 tocsection-3"><a href="#Normal_invocation"><span class="tocnumber">2.1</span> <span class="toctext">Normal invocation</span></a></li>
<li class="toclevel-2 tocsection-4"><a href="#Libtool_invocation"><span class="tocnumber">2.2</span> <span class="toctext">Libtool invocation</span></a></li>
<li class="toclevel-2 tocsection-5"><a href="#Getting_a_backtrace_.28aka_stack_trace.29"><span class="tocnumber">2.3</span> <span class="toctext">Getting a backtrace (aka stack trace)</span></a></li>
<li class="toclevel-2 tocsection-6"><a href="#Loading_a_core_file"><span class="tocnumber">2.4</span> <span class="toctext">Loading a core file</span></a></li>
<li class="toclevel-2 tocsection-7"><a href="#Attaching_to_a_running_process"><span class="tocnumber">2.5</span> <span class="toctext">Attaching to a running process</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-8"><a href="#Valgrind_.2F_Memory_Leaks"><span class="tocnumber">3</span> <span class="toctext">Valgrind / Memory Leaks</span></a></li>
<li class="toclevel-1 tocsection-9"><a href="#Dmalloc"><span class="tocnumber">4</span> <span class="toctext">Dmalloc</span></a></li>
<li class="toclevel-1 tocsection-10"><a href="#Profiling"><span class="tocnumber">5</span> <span class="toctext">Profiling</span></a>
<ul>
<li class="toclevel-2 tocsection-11"><a href="#Using_gprof"><span class="tocnumber">5.1</span> <span class="toctext">Using gprof</span></a></li>
<li class="toclevel-2 tocsection-12"><a href="#Using_strace"><span class="tocnumber">5.2</span> <span class="toctext">Using strace</span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-13"><a href="#References"><span class="tocnumber">6</span> <span class="toctext">References</span></a></li>
</ul>
</div>

<h2><span class="mw-headline" id="Debugging_Net-SNMP_Applications">Debugging Net-SNMP Applications</span></h2>
<p>This page contains some tips on debugging Net-SNMP Applications. Often, when an application crashes, you may be asked to run the application under a debugger, or provide details from a <a rel="nofollow" class="external text" href="http://en.wikipedia.org/wiki/Core_dump">core dump</a>. This page presents a simple introduction to one debugger, GDB.
</p><p><br />
</p>
<h2><span class="mw-headline" id="GDB_.2F_DDD">GDB / DDD</span></h2>
<p>GDB is the GNU debugger, which is a terminal-based debugger. DDD is a graphical (GUI) front end to GDB.
</p>
<h3><span class="mw-headline" id="Normal_invocation">Normal invocation</span></h3>
<p>The simplest way to run an application under GDB is like so:
</p>
<pre>$ <b>gdb /usr/local/sbin/snmpd</b>
(gdb) <b>run -f -Lo</b>
</pre>
<p>The '-f' is necessary to prevent snmpd from forking into the background, and '-Lo' tells snmpd to send log messages to STDOUT (i.e. print them in the GDB console window).
</p>
<h3><span class="mw-headline" id="Libtool_invocation">Libtool invocation</span></h3>
<p>Net-SNMP uses libtool while building it's applications. This means that sometimes the applications in the source/build directory are not actually binaries, but shell scripts. The libtool script does some magic so that the applications will run using the shared libraries in the build directory, instead of any libraries installed on the system. To run an application with GDB, you have to run GDB through libtool, like so:
</p>
<pre>$ <b>./libtool --mode=execute gdb agent/snmpd</b>
(gdb) <b>run -f -Lo</b>
</pre>
<h3><span class="mw-headline" id="Getting_a_backtrace_.28aka_stack_trace.29">Getting a backtrace (aka stack trace)</span></h3>
<p>Once you have got an application running under GDB, you can easily get a backtrace, which will display the sequence of functions that were called to arrive at the point where the debugger is currently stopped.
</p>
<pre>(gdb) <b>bt</b>
#0  0x10153d78 in init_snmp(type=0x101bb140 "snmp") at snmp_api.c:854
#1  0x1000524c in main(argc=3, argv=0x7fe04636) at snmpd.c:910
</pre>
<h3><span class="mw-headline" id="Loading_a_core_file">Loading a core file</span></h3>
<p>If an application has crashed, often it will leave a core file. This core file can usually be loaded into GDB to get debugging information after the fact. Simply add the path to the core file after the path to the application when starting GDB.
</p>
<pre>$ <b>gdb /usr/local/sbin/snmpd /tmp/core.70816</b>
</pre>
<p>Often this will tell you why the application crashed (e.g. SIGSEGV, aka signal 11). You can then get a backtrace to send to one of the mailing lists for interpretation.
</p><p>If testing snmpd (or another application) from within the source tree, you'll need to run gdb via libtool:
</p>
<pre>$ <b>./libtool --mode=execute gdb agent/snmpd /tmp/core.70816</b>
</pre>
<h3><span class="mw-headline" id="Attaching_to_a_running_process">Attaching to a running process</span></h3>
<p>If your agent is running and you need to see what's going on inside of it (and you can't restart it directly within gdb itself), specify the process ID at the end to attach to it:
</p>
<pre>$ <b>gdb /usr/local/sbin/snmpd 12345</b>
</pre>
<p>After which you can get back traces, set breakpoints, etc.
</p>
<h2><span class="mw-headline" id="Valgrind_.2F_Memory_Leaks">Valgrind / Memory Leaks</span></h2>
<p>To check for memory leaks, you can try <a rel="nofollow" class="external text" href="http://valgrind.org/">Valgrind</a>. Note, however, that Net-SNMP relies on the operating system to cleanup memory when an application exits, so there will be lots of un-released memory when the application exits.  Please don't report this as a bug. We are only interested in memory leaks that grow over time.
</p><p>If you don't want to read the Valgrind docs, here is a quick example:
</p>
<pre>valgrind --tool=memcheck --leak-check=full --show-reachable=yes snmpd -f -Lo
</pre>
<p>Note that since some memory leaks may be reported anyway just from initialization allocations that were never cleaned up, the best way to check for memory leaks in your mib-module code is to run valgrind twice.  In the first run, perform a single <a href="index.php/Snmpget.html" title="Snmpget">snmpget</a> or <a href="index.php/Snmpwalk.html" title="Snmpwalk">snmpwalk</a> on your MIB implemenatation.  The next time, perform 1000 of the same task.  Then compare the two runs and if the memory usage is different for some section of code (by a factor of 1000) then you've definitely found a leak.
</p>
<h2><span class="mw-headline" id="Dmalloc">Dmalloc</span></h2>
<p>Detecting memory errors in Net-SNMP is not only possible with Valgrind but also with <a rel="nofollow" class="external text" href="http://dmalloc.com/">Dmalloc</a>. While Valgrind is more powerful than Dmalloc, Dmalloc is supported on more platforms than Valgrind (e.g. Solaris and Cygwin). Proceed as follows to analyze Net-SNMP with Dmalloc:
</p>
<ol><li> Install dmalloc.</li>
<li> Modify &lt;dmalloc.h&gt; and insert #undef strndup just before the declaration of strndup().</li>
<li> Configure Net-SNMP with the option --with-dmalloc=&lt;dmalloc prefix&gt;.</li>
<li> Build Net-SNMP.</li>
<li> Make sure that the dmalloc function has been defined in your shell. See also the <a rel="nofollow" class="external text" href="http://dmalloc.com/docs/latest/online/dmalloc_4.html">dmalloc manual</a> for the details.</li>
<li> Set dmalloc options, e.g. <pre>dmalloc high -p print-messages</pre></li>
<li> Start Net-SNMP, e.g. as follows: <pre>agent/snmpd -f -Lo -Mmibs</pre></li></ol>
<h2><span class="mw-headline" id="Profiling">Profiling</span></h2>
<p>To look into performance issues, profiling helps a lot. Here is how to do it.
</p>
<h3><span class="mw-headline" id="Using_gprof">Using gprof</span></h3>
<p>First, you need to build a static version of Net-SNMP with profiling information:
</p>
<pre> ./configure --enable-static --disable-shared --with-cflags=-pg --with-ldflags=-pg ...
</pre>
<p>Then, run the agent and/or your commands as usual. Upon exit, they will leave a gmon.out file in the current directory. If you run multiple commands, do it from different directories so the gmon.out files don't overwrite each other. E.g.
</p>
<pre> /path/to/snmpd -f -Lo --rocommunity=foobar localhost
</pre>
<p>Finally, run gprof to analyze the profile data:
</p>
<pre> gprof /path/to/snmpd gmon.out
</pre>
<h3><span class="mw-headline" id="Using_strace">Using strace</span></h3>
<p>An alternative program to gprof is to track the system calls using <b>strace</b>. gprof is a significantly better tool, but you may already have strace installed.
</p><p>E.g. usage on Linux:
</p>
<pre> strace -tt -p &lt;pid_of_snmpd&gt;
</pre>
<p>Other platforms may have a similar tool with a different name, e.g. truss on Solaris.
</p>
<h2><span class="mw-headline" id="References">References</span></h2>
<ul><li> <a rel="nofollow" class="external text" href="http://fedoraproject.org/wiki/StackTraces">Stack traces for Fedora RPM packages</a></li>
<li> <a rel="nofollow" class="external text" href="http://linux.bytesex.org/gdb.html">gdb mini intro</a></li></ul>

<!-- 
NewPP limit report
Cached time: 20240514175634
Cache expiry: 0
Dynamic content: true
CPU time usage: 0.007 seconds
Real time usage: 0.010 seconds
Preprocessor visited node count: 68/1000000
Preprocessor generated node count: 96/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 - -total
-->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="index455e.html?title=Debugger&amp;oldid=5728">http://www.net-snmp.org/wiki/index.php?title=Debugger&amp;oldid=5728</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="index.php/Debugger.html" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="index.php/Talk_Debugger.html?title=Talk:Debugger&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="indexecb8.html?title=Debugger&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="index8323.html?title=Debugger&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="index042e.html?title=Special:UserLogin&amp;returnto=Debugger&amp;returntoquery=printable%3Dyes&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="index995d.html?title=Special:UserLogin&amp;returnto=Debugger&amp;returntoquery=printable%3Dyes" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="index.php/Main_Page.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-project" role="navigation">
		<h3>project</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Web-Site"><a href="../index.html" rel="nofollow">Web Site</a></li>
											<li id="n-Wiki"><a href="index.php/Main_Page.html">Wiki</a></li>
											<li id="n-Download"><a href="../download.html" rel="nofollow">download</a></li>
											<li id="n-Mailing-Lists"><a href="../support/mailinglists.html" rel="nofollow">Mailing Lists</a></li>
											<li id="n-Bug-Reports"><a href="../support/bugreports.html" rel="nofollow">Bug Reports</a></li>
											<li id="n-Patches"><a href="../support/patches.html" rel="nofollow">Patches</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-documentation" role="navigation">
		<h3>documentation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Tutorials"><a href="index.php/Tutorials.html">Tutorials</a></li>
											<li id="n-FAQ"><a href="index.php/FAQ.html">FAQ</a></li>
											<li id="n-Good-Answers"><a href="index.php/Category_GoodAnswer.html">Good Answers</a></li>
											<li id="n-Manual-Pages"><a href="../man/index.html" rel="nofollow">Manual Pages</a></li>
											<li id="n-Tools"><a href="index.php/Category_Tools.html">Tools</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-wiki" role="navigation">
		<h3>wiki</h3>
		<div class='pBody'>
							<ul>
											<li id="n-recentchanges"><a href="index.php/Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="index.php/Notes20111219.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.net-snmp.org/wiki/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Net-SNMP Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="index.php/Special_WhatLinksHere/Debugger.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="index.php/Special_RecentChangesLinked/Debugger.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="index.php/Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-permalink"><a href="index455e.html?title=Debugger&amp;oldid=5728" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="index8432.html?title=Debugger&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 6 September 2013, at 14:03.</li>
									<li id="privacy"><a href="index.php/Net-SNMP_Wiki_Privacy_policy.html" title="Net-SNMP Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="index.php/Net-SNMP_Wiki_About.html" title="Net-SNMP Wiki:About">About Net-SNMP Wiki</a></li>
									<li id="disclaimer"><a href="index.php/Net-SNMP_Wiki_General_disclaimer.html" title="Net-SNMP Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":209});
} );</script></body>
<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=Debugger&printable=yes by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:28:21 GMT -->
</html>
