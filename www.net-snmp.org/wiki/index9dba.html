

<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=Tut:Extending_snmpd_using_shell_scripts&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:27:41 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for Tut:Extending snmpd using shell scripts - Net-SNMP Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"Tut:Extending_snmpd_using_shell_scripts","wgTitle":"Tut:Extending snmpd using shell scripts","wgCurRevisionId":5909,"wgRevisionId":0,"wgArticleId":2140,"wgIsArticle":!1,"wgIsRedirect":!1,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":!0,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"Tut:Extending_snmpd_using_shell_scripts","wgRelevantArticleId":2140,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="load34a1.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="load3a95.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.26.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://www.net-snmp.org/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://www.net-snmp.org/wiki/opensearch_desc.php" title="Net-SNMP Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://www.net-snmp.org/wiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Net-SNMP Wiki Atom feed" href="http://www.net-snmp.org/wiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-Tut_Extending_snmpd_using_shell_scripts skin-monobook action-edit">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">View source for Tut:Extending snmpd using shell scripts</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Net-SNMP Wiki</div>
					<div id="contentSub">‚Üê <a href="http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts" title="Tut:Extending snmpd using shell scripts">Tut:Extending snmpd using shell scripts</a></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.net-snmp.org/wiki/index.php?title=Net-SNMP_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Net-SNMP Wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">This tutorial is intended as a brief introduction to extending the
''snmpd'' agent using shell scripts.

= Documentation =

Shell scripts are configure in ''snmpd.conf''. The man page for snmpd.conf
has a section on
[http://net-snmp.sourceforge.net/docs/man/snmpd.conf.html#lbAZ EXTENDING AGENT FUNCTIONALITY]
which covers the ''exec'', ''extend'', ''pass'' and ''pass-persist'' methods or executing a script to implement a MIB.

There is also a [http://www.net-snmp.org/docs/FAQ.html#What_s_the_difference_between__exec____sh____extend__and__pass__ FAQ] on the
differences between the various methods.

= Examples scripts =

== Simplistic example ==
Here is a simple example using echo:

* snmpd.conf
 rocommunity testing
 extend test /bin/echo hello

* retrieving value

 $ snmpwalk -v2c -c testing 127.0.0.1 nsExtendOutput1
 NET-SNMP-EXTEND-MIB::nsExtendOutput1Line."test" = STRING: hello
 NET-SNMP-EXTEND-MIB::nsExtendOutputFull."test" = STRING: hello
 NET-SNMP-EXTEND-MIB::nsExtendOutNumLines."test" = INTEGER: 1
 NET-SNMP-EXTEND-MIB::nsExtendResult."test" = INTEGER: 0

* finding the OID

 $ snmptranslate -On NET-SNMP-EXTEND-MIB::nsExtendOutput1Line.\"test\"
 .1.3.6.1.4.1.8072.1.3.2.3.1.1.4.116.101.115.116

== Use the source, Luke ==
The GIT tree has 3 example scripts.

* [https://sourceforge.net/p/net-snmp/code/ci/master/tree/local/passtest BASH pass script] example
* [https://sourceforge.net/p/net-snmp/code/ci/master/tree/local/passtest.pl PERL pass script] example
* [https://sourceforge.net/p/net-snmp/code/ci/master/tree/local/pass_persisttest PERL pass-persist script] example

== User contributed ==
Here are user contributed examples:

=== Pass persist ===
The pass_persist option is very useful if you need to implement some specific OID subtree, but it has a few traps and features which are poorly communicated, or not even mentioned in the snmpd.conf man page.

# the shutdown protocol: when the snmpd server wants to shutdown, it tells your script by sending a blank line on stdin.  
# snmpd sends a PING at the start of every request (I read the docs to mean that it is sent once, on script startup).
# the list of types you can return is quite limited. It is actually described in the docs for pass, which says that the type must be "one of the text strings: integer, gauge, counter, timeticks, ipaddress, objectid, or string"
# because you cannot return DateAndTime (RFC 2579), for datetime values I've resorted to returning two values (two separate OIDs):
## seconds-since-epoch (type counter)
## datetime formatted as ISO-8601 string (type string)
# there doesn't seem to be a way for getnext to distinguish between an invalid input OID, and running past the end of the supported tree.


Other things I've learned:

# your MIB must be valid, otherwise snmpget won't even query the daemon.
# you will probably need to add a line to the security section of snmpd.conf, to allow access to the OID subtree e.g. something like (where nnnnn is your Private Enterprise Number): &lt;pre>view all    included    .1.3.6.1.4.1.nnnnn&lt;/pre>
# I used python to implement my pass_persist script. You must flush stdout after sending each line, otherwise snmpd will timeout after waiting for your response. Or invoke python with -u option (unbuffered stdin/stdout).
# python stdin.readline() preserves the newline, so you need to strip it.


My pass_persist daemon main loop looks like this:

&lt;pre>
    def getline():
        return sys.stdin.readline().strip()


    def output(line):
        sys.stdout.write(line + "\n")
        sys.stdout.flush()


    def main():
        logger.info("starting pass_persist daemon")

        try:
            while True:
                command = getline()

                if command == "":
                    logger.info("stopping pass_persist daemon")
                    sys.exit(0)

                # snmpd 5.4.2.1 sends a PING before every snmp command
                elif command == "PING":
                    output("PONG")

                elif command == "set":
                    oid = getline()
                    type_and_value = getline()
                    logger.info("%s %s %s" % (command, oid, type_and_value))
                    #snmp_set(oid, type_and_value)
                    # set not supported yet...
                    output("not-writable")

                elif command == "get":
                    oid = getline()
                    logger.info("%s %s" % (command, oid))
                    snmp_get(oid)

                elif command == "getnext":
                    oid = getline()
                    logger.info("%s %s" % (command, oid))
                    snmp_getnext(oid)

                else:
                    logger.error("Unknown command: %s" % command)

        # If we get an exception, spit it out to the log then quit
        # (by propagating exception).
        # snmpd will restart the script on the next request.
        except Exception, e:
            logger.exception("")
            raise
&lt;/pre>

== Debugging script issues ==

If your pass script isn't working, here are a few things you can try:

=== check script permissions ===
Make sure that the script is executable.

 chmod a+x /tmp/my_script

=== check for SELinux restrictions ===
On Linux systems with SELinux enabled, the script must have the right context. You can check for SELinux access violations with
 grep AVC /var/log/audit/audit.log | grep snmp

=== check access control ===
Pass scripts generally fall in the enterprises branch. Some vendors default snmpd configuration do not include this branch. To see if you can see any objects in the enterprises branch, try this command:

 snmpgetnext -On -v 1 -c public localhost .1.3.6.1.4.1

If you get back an object that starts with .1.3.6.1.4.1, then you should be ok.

=== turn on debugging ===
Try running snmpd in the foreground, with debugging

 snmpd -f -Lo -Ducd-snmp/pass

which should result in debug output something like

  ucd-snmp/pass: pass-running:  /bin/sh /tmp/my_script -g .1.3.6.1.4.1.2021.224

=== touch a temporary file ===
At the top of your script, touch a temporary file. You can check the time stamp of the temporary file to see if the script is run. A simple example:

 #!/bin/bash
 
 echo "$0 run at `date`" >> /tmp/my_script.debug
 
 # handle pass arguments
 # ...

= External examples =

There are many examples on the [[Net-snmp_extensions]] page.
</textarea><div class="templatesUsed"></div><p id="mw-returnto">Return to <a href="http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts" title="Tut:Extending snmpd using shell scripts">Tut:Extending snmpd using shell scripts</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts">http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="http://www.net-snmp.org/wiki/index.php/Tut:Extending_snmpd_using_shell_scripts" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.net-snmp.org/wiki/index.php?title=Talk:Tut:Extending_snmpd_using_shell_scripts&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="http://www.net-snmp.org/wiki/index.php?title=Tut:Extending_snmpd_using_shell_scripts&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://www.net-snmp.org/wiki/index.php?title=Tut:Extending_snmpd_using_shell_scripts&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=Tut%3AExtending+snmpd+using+shell+scripts&amp;returntoquery=action%3Dedit&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=Tut%3AExtending+snmpd+using+shell+scripts&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="http://www.net-snmp.org/wiki/index.php/Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-project" role="navigation">
		<h3>project</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Web-Site"><a href="http://www.net-snmp.org/" rel="nofollow">Web Site</a></li>
											<li id="n-Wiki"><a href="http://www.net-snmp.org/wiki/index.php/Main_Page">Wiki</a></li>
											<li id="n-Download"><a href="http://www.net-snmp.org/download.html" rel="nofollow">download</a></li>
											<li id="n-Mailing-Lists"><a href="http://www.net-snmp.org/support/mailinglists.html" rel="nofollow">Mailing Lists</a></li>
											<li id="n-Bug-Reports"><a href="http://www.net-snmp.org/support/bugreports.html" rel="nofollow">Bug Reports</a></li>
											<li id="n-Patches"><a href="http://www.net-snmp.org/support/patches.html" rel="nofollow">Patches</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-documentation" role="navigation">
		<h3>documentation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Tutorials"><a href="http://www.net-snmp.org/wiki/index.php/Tutorials">Tutorials</a></li>
											<li id="n-FAQ"><a href="http://www.net-snmp.org/wiki/index.php/FAQ">FAQ</a></li>
											<li id="n-Good-Answers"><a href="http://www.net-snmp.org/wiki/index.php/Category:GoodAnswer">Good Answers</a></li>
											<li id="n-Manual-Pages"><a href="http://www.net-snmp.org/man" rel="nofollow">Manual Pages</a></li>
											<li id="n-Tools"><a href="http://www.net-snmp.org/wiki/index.php/Category:Tools">Tools</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-wiki" role="navigation">
		<h3>wiki</h3>
		<div class='pBody'>
							<ul>
											<li id="n-recentchanges"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="http://www.net-snmp.org/wiki/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.net-snmp.org/wiki/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Net-SNMP Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="http://www.net-snmp.org/wiki/index.php/Special:WhatLinksHere/Tut:Extending_snmpd_using_shell_scripts" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChangesLinked/Tut:Extending_snmpd_using_shell_scripts" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="http://www.net-snmp.org/wiki/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-info"><a href="http://www.net-snmp.org/wiki/index.php?title=Tut:Extending_snmpd_using_shell_scripts&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="http://www.net-snmp.org/wiki/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="privacy"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:Privacy_policy" title="Net-SNMP Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:About" title="Net-SNMP Wiki:About">About Net-SNMP Wiki</a></li>
									<li id="disclaimer"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:General_disclaimer" title="Net-SNMP Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":127});
} );</script></body>
<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=Tut:Extending_snmpd_using_shell_scripts&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:27:41 GMT -->
</html>
