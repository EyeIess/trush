

<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from www.net-snmp.org/wiki/index.php/MFD:ifTable:Data_Access by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 19:03:50 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>MFD:ifTable:Data Access - Net-SNMP Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"MFD:ifTable:Data_Access","wgTitle":"MFD:ifTable:Data Access","wgCurRevisionId":5246,"wgRevisionId":5246,"wgArticleId":2239,"wgIsArticle":!0,"wgIsRedirect":!1,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":!1,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"MFD:ifTable:Data_Access","wgRelevantArticleId":2239,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="../load34a1.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="../load3a95.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.26.3" />
<link rel="shortcut icon" href="../../favicon.html" />
<link rel="search" type="application/opensearchdescription+xml" href="../opensearch_desc.php" title="Net-SNMP Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://net-snmp.sourceforge.net/wiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Net-SNMP Wiki Atom feed" href="../apidf90.php?title=Special:RecentChanges&amp;feed=atom" />
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-MFD_ifTable_Data_Access skin-monobook action-view">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">MFD:ifTable:Data Access</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Net-SNMP Wiki</div>
					<div id="contentSub"></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text" lang="en" dir="ltr" class="mw-content-ltr"><div align="right" style="float: right; width: 20em; border-color: black; border-style: solid; border-width: 1px; margin-left: 10px;">
<table style="width: 100%;">

<tr style="font-size: 1.2em;" bgcolor="#ddd">
<td colspan="2" style="text-align: center;"> MFD Tutorial
</td></tr>
<tr style="text-align: left;">
<td>
<ul><li> <a href="MIB_for_Dummies.html" title="MIB for Dummies">MIB for Dummies</a></li>
<li> <a href="MFD_IF-MIB.html" title="MFD:IF-MIB">MFD:IF-MIB</a></li>
<li> <a href="MFD_ifTable.html" title="MFD:ifTable">MFD:ifTable</a>
<ul><li> <a href="MFD_ifTable_mib2c.html" title="MFD:ifTable:mib2c">MFD:ifTable:mib2c‎</a></li>
<li> <a href="MFD_ifTable_Data_Structures.html" title="MFD:ifTable:Data Structures">MFD:ifTable:Data Structures</a></li>
<li> <strong class="selflink">MFD:ifTable:Data Access</strong></li>
<li> <a href="MFD_ifTable_Get_Data.html" title="MFD:ifTable:Get Data">MFD:ifTable:Get Data</a></li>
<li> <a href="MFD_ifTable_Testing.html" title="MFD:ifTable:Testing">MFD:ifTable:Testing</a></li></ul></li>
<li> <a href="MFD_ifXTable.html" title="MFD:ifXTable">MFD:ifXTable</a>
<ul><li> <a href="MFD_ifXTable_mib2c.html" title="MFD:ifXTable:mib2c">MFD:ifXTable:mib2c‎</a></li>
<li> <a href="MFD_ifXTable_Data_Structures.html" title="MFD:ifXTable:Data Structures">MFD:ifXTable:Data Structures</a></li>
<li> <a href="MFD_ifXTable_Data_Access.html" title="MFD:ifXTable:Data Access">MFD:ifXTable:Data Access</a></li>
<li> <a href="MFD_ifXTable_Get_Data.html" title="MFD:ifXTable:Get Data">MFD:ifXTable:Get Data</a></li>
<li> <a href="MFD_ifXTable_Testing_Gets.html?title=MFD:ifXTable:Testing_Gets&amp;action=edit&amp;redlink=1" class="new" title="MFD:ifXTable:Testing Gets (page does not exist)">MFD:ifXTable:Testing Gets</a></li>
<li> <a href="MFD_ifXTable_Set_Data.html?title=MFD:ifXTable:Set_Data&amp;action=edit&amp;redlink=1" class="new" title="MFD:ifXTable:Set Data (page does not exist)">MFD:ifXTable:Set Data</a></li>
<li> <a href="MFD_ifXTable_Testing_Sets.html?title=MFD:ifXTable:Testing_Sets&amp;action=edit&amp;redlink=1" class="new" title="MFD:ifXTable:Testing Sets (page does not exist)">MFD:ifXTable:Testing Sets</a></li></ul></li></ul>
</td></tr></table>
</div>
<div id="toc" class="toc"><div id="toctitle"><h2>Contents</h2></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="#MFD_:_ifTable_data_access"><span class="tocnumber">1</span> <span class="toctext">MFD&#160;: ifTable data access</span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="#Introduction"><span class="tocnumber">1.1</span> <span class="toctext">Introduction</span></a></li>
<li class="toclevel-2 tocsection-3"><a href="#Initialization"><span class="tocnumber">1.2</span> <span class="toctext">Initialization</span></a>
<ul>
<li class="toclevel-3 tocsection-4"><a href="#Data_init"><span class="tocnumber">1.2.1</span> <span class="toctext">Data init</span></a></li>
<li class="toclevel-3 tocsection-5"><a href="#Container_init"><span class="tocnumber">1.2.2</span> <span class="toctext">Container init</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-6"><a href="#Cache_Helper"><span class="tocnumber">1.3</span> <span class="toctext">Cache Helper</span></a>
<ul>
<li class="toclevel-3 tocsection-7"><a href="#Cache_Load"><span class="tocnumber">1.3.1</span> <span class="toctext">Cache Load</span></a></li>
<li class="toclevel-3 tocsection-8"><a href="#Cache_Unload"><span class="tocnumber">1.3.2</span> <span class="toctext">Cache Unload</span></a></li>
</ul>
</li>
<li class="toclevel-2 tocsection-9"><a href="#Row_preparation"><span class="tocnumber">1.4</span> <span class="toctext">Row preparation</span></a></li>
</ul>
</li>
</ul>
</div>

<h2><span class="mw-headline" id="MFD_:_ifTable_data_access">MFD&#160;: ifTable data access</span></h2>
<p>Now that we have the basic code generated, the next step is to
implement the data access functions. The data access code is
responsible for reading the available data and determining the valid
indexes. For each data item, or row, a new <i>row request</i>
structure is created. The <i>mib context</i>, contained in the
<i>row request</i>, is initialized with the appropriate index
data for the row, and then the row is inserted into the table
container. The module can also initialize the <i>data context</i> at
this time, or delay that processing for later. (see
&lt;a href="../../faq.html#init_data_context"&gt;When should I initialize
the data context?&lt;/a&gt;)
</p><p>In the Linux kernel, interface
statistics are available by reading the file /proc/net/dev. The format
looks like this:
</p>
<table><tr><td></td><td bgcolor="CCCCCC">
<pre>Inter-|   Receive                                                |  Transmit
 face |bytes    packets errs drop fifo frame compressed multicast|bytes    packets errs drop fifo colls carrier compressed
    lo:45312667  382442    0    0    0     0          0         0 45312667  382442    0    0    0     0       0          0
  eth0:2116574495 13308144    0    0    0     0          0         0 816012310 7565504    0    0    0 3604480       0          0
</pre>
             </td></tr></table>
<p>(If you want to try this tutorial on a non-Linux system, just copy
the above data to any file, and update the code to use a static copy
of the file. Note that some ioctl calls are made for some data that
isn't found in /proc/net/dev. If your OS doesn't support the ioctl
calls that are used, comment them out or replace them with code to
get the data for your OS.)
</p><p>As is often the case with external data, the interfaces data we get
from the kernel is not sorted by the index specified by the MIB. The
kernel reports data by interface names ('eth0', 'lo', etc), and the
ifTable is ordered by the arbitrary ifIndex.
</p><p>To keep this tutorial simple, we aren't going to implment
every column in the ifTable. In particular, the ifAdminStatus,
ifOperStatus and ifLastChange columns will not be implemented.
This also lets us ignore set support for the time being.
We'll cover dealing with these columns later on.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Introduction">Introduction</span></h3>
<p>The default data access method used by MFD is the
<var>container-cached</var> method. Basically this means that a
<var>netsnmp_container</var> will be used to cache the data for
our table. (If you don't want caching, don't worry. You can
configure the cache to be rebuilt for every request.)
</p><p><br />
</p>
<h3><span class="mw-headline" id="Initialization">Initialization</span></h3>
<p>There are two initialization routines called for
<var>container-cached</var>. One is the data init routine that
is common to all <var>MFD</var> code. The other is specificly
to init the container and cache.
</p>
<h4><span class="mw-headline" id="Data_init">Data init</span></h4>
<p>The data init routine is called at startup, and
any necessary data related setup can be done here. In this
example, we are going to set up a <var>netsnmp_column_info</var>
structure to let the agent know which columns we will be
implementing. This will allow the agent to skip these columns.
</p><p>The format of the data file we are using changed between the
2.2 and 2.4 versions of the kernel. We need to know which format
the current system is using, so we call a routine that will take a peek
at the data file to determine the format of the file.
</p>
<table><tr>
          <td width="20"></td>
          <td><b>Modified code</b></td>
        </tr><tr>
          <td></td>
          <td bgcolor="CCCCCC">
<pre>int
ifTable_init_data(ifTable_registration_ptr ifTable_reg)
{<font color="blue">
    static unsigned int my_columns[] = {
        COLUMN_IFINDEX, COLUMN_IFTYPE, COLUMN_IFPHYSADDRESS,
        COLUMN_IFINOCTETS, COLUMN_IFINUCASTPKTS,
        COLUMN_IFOUTOCTETS, COLUMN_IFOUTUCASTPKTS };
    static netsnmp_column_info valid_columns;
</font>
    DEBUGMSGTL(("verbose:ifTable_init_data", "called\n"));

    /*
     ***************************************************
     ***             START EXAMPLE CODE              ***
     ***---------------------------------------------***/<font color="blue">
    /*
     * we only want to process certain columns, and ignore
     * anything else.
     */
    valid_columns.isRange = 0;
    valid_columns.details.list = my_columns;
    valid_columns.list_count = sizeof(my_columns)/sizeof(int);
    ifTable_valid_columns_set(&amp;valid_columns);

    _choose_proc_format();</font>
    /*
     ***---------------------------------------------***
     ***              END  EXAMPLE CODE              ***
     ***************************************************/

    return MFD_SUCCESS;
}
</pre>
</td></tr>
</table>
<h4><span class="mw-headline" id="Container_init">Container init</span></h4>
<p>The container init routine is called right after the data
init routine. We are going to leave the default code as-is,
to have a container allocated for us. (The timeout could
be increased, depending on your tolerance for stale data.
Set it to -1 if you want to rebuild the cache for every
request.) We are going to to set one extra flag, to have
the cache pre-load right away. This will allow the agent to
discover all the index values at startup, which is necessar
because other parts of the agent need to know what ifIndex
values are valid.
</p>
<table><tr>
          <td width="20"></td>
          <td><b>Modified code</b></td>
        </tr><tr>
          <td></td>
          <td bgcolor="CCCCCC">
<pre>void
ifTable_container_init(netsnmp_container ** container_ptr_ptr,
                       netsnmp_cache * cache)
{
    DEBUGMSGTL(("verbose:ifTable_container_init", "called\n"));

    if ((NULL == cache) || (NULL == container_ptr_ptr)) {
        snmp_log(LOG_ERR, "bad params to ifTable_container_init\n");
        return;
    }

    /*
     * For advanced users, you can use a custom container. If you
     * do not create one, one will be created for you.
     */
    *container_ptr_ptr = NULL;

    /*
     * Also for advance users, you can set parameters for the
     * cache. Do not change the magic pointer, as it is used
     * by the MFD helper.
     */
    cache-&gt;timeout = 30;        /* seconds */
<font color="blue">
    /*
     * preload to assign initial index values
     */
    cache-&gt;flags |= NETSNMP_CACHE_PRELOAD;</font>
}
</pre>
</td></tr>
</table>
<h3><span class="mw-headline" id="Cache_Helper">Cache Helper</span></h3>
<p>The cache helper is used to load the indexes (and by default,
the data) for each row in a table. In this tutorial, we will be
using all of the default behavior, with the addition of the
pre-loading (remember the flag we set during continer init?).
</p>
<h4><span class="mw-headline" id="Cache_Load">Cache Load</span></h4>
<p>The default behaviour is to load the cache when a request is
received for data from the table. If requests continue to come
in, the cached data will be used until the time expires, at
which point the cache will be unloaded and the re-loaded. 
</p>
<table><tr><td width="20"></td><td bgcolor="CCCCCC">
<pre>int
ifTable_cache_load(netsnmp_container * container)
{
    ifTable_rowreq_ctx *rowreq_ctx;<font color="blue">
    int rc = MFD_SUCCESS;</font>

    /*
     * this example code is based on a data source that is a
     * text file to be read and parsed.
     */
    FILE           *filep;
    char            line[MAX_LINE_SIZE];<font color="blue">
    int             fd;</font>

    /*
     * temporary storage for index values
     */
    /*
     * ifIndex(1)/InterfaceIndex/ASN_INTEGER/long(long)//l/A/w/e/R/d/H
     */
    long            ifIndex;

    DEBUGMSGTL(("verbose:ifTable_cache_load", "called\n"));

    /*
     ***************************************************
     ***             START EXAMPLE CODE              ***
     ***---------------------------------------------***/
    /*
     * open our data file.
     */
    filep = fopen(<font color="blue">"/proc/net/dev"</font>, "r");
    if (NULL == filep) {
        return MFD_RESOURCE_UNAVAILABLE;
    }<font color="blue">

    /*
     * create socket for ioctls
     */
    fd = socket(AF_INET, SOCK_DGRAM, 0);
    if(fd &lt; 0) {
        fclose(filep);
        return MFD_RESOURCE_UNAVAILABLE;
    }

    /*
     * ignore header lines
     */
    fgets(line, sizeof(line), filep);
    fgets(line, sizeof(line), filep);
</font>
    /*
     ***---------------------------------------------***
     ***              END  EXAMPLE CODE              ***
     ***************************************************/
    /*
     * TODO: update container
     *
     * loop over your data, allocate, set index, insert into the container
     */<font color="blue">
    /*
     * The rest of the file provides the statistics for an interface.
     * Read in each line in turn, isolate the interface name
     *   and retrieve (or create) the corresponding data structure.
     */</font>
    while (1) {<font color="blue">
        struct ifreq    ifrq;
        int             scan_count;
        char           *stats, *ifstart;
        unsigned long   rec_pkt, rec_oct, rec_err, rec_drop;
        unsigned long   snd_pkt, snd_oct, snd_err, snd_drop, coll;
</font>
        /*
         ***************************************************
         ***             START EXAMPLE CODE              ***
         ***---------------------------------------------***/
        /*
         * get a line (skip blank lines)
         */
        do {
            if (!fgets(line, sizeof(line), filep)) {
                /*
                 * we're done 
                 */
                fclose(filep);
                filep = NULL;
            }
        } while (filep &amp;&amp; (line[0] == '\n'));

        /*
         * check for end of data
         */
        if (NULL == filep)
            break;
        
        /*
         * TODO: parse line
         * parse line into variables
         */<font color="blue">
        ifstart = line;
        while (*ifstart &amp;&amp; *ifstart == ' ')
            ifstart++;
        if ((!*ifstart) || ((stats = strrchr(ifstart, ':')) == NULL)) {
            snmp_log(LOG_ERR,
                     "interface data format error 1, line ==|%s|\n",
                     line);
            DEBUGMSGTL(("ifTable", "found '%s'\n", ifstart));
            continue;
        }

        /*
         * If we've met this interface before, use the same index.
         * Otherwise find an unused index value and use that.
         */
        *stats++ = 0; /* null terminate name */
        ifIndex = se_find_value_in_slist("interfaces", ifstart);
        if (ifIndex == SE_DNE) {
            ifIndex = se_find_free_value_in_slist("interfaces");
            if (ifIndex == SE_DNE)
                ifIndex = 1;       /* Completely new list! */
            se_add_pair_to_slist("interfaces",
                                 strdup(ifstart), ifIndex);
            DEBUGMSGTL(("ifTable:ifIndex", "new ifIndex&#160;%d for&#160;%s\n",
                        ifIndex, ifstart));
        }
        if ((NULL == ifstart) || (0 == ifIndex)) {
            rc = MFD_END_OF_DATA;
            break;
        }
</font>
        /*
         ***---------------------------------------------***
         ***              END  EXAMPLE CODE              ***
         ***************************************************/

        /*
         * allocate an row context and set the index(es)
         */
        rowreq_ctx = ifTable_allocate_rowreq_ctx();
        if (NULL == rowreq_ctx) {
            snmp_log(LOG_ERR, "memory allocation failed\n");<font color="blue">
            rc = MFD_RESOURCE_UNAVAILABLE;
            break;</font>
        }
        if (MFD_SUCCESS&#160;!= ifTable_indexes_set(rowreq_ctx, ifIndex)) {
            snmp_log(LOG_ERR, "error setting index while loading "
                     "ifTable cache.\n");
            ifTable_release_rowreq_ctx(rowreq_ctx);
            continue;
        }
<font color="blue">        
        rec_pkt = rec_oct = rec_err = rec_drop = 0;
        snd_pkt = snd_oct = snd_err = snd_drop = coll = 0;
        if (scan_line_to_use == scan_line_2_2) {
            scan_count = sscanf(stats, scan_line_to_use,
                                &amp;rec_oct, &amp;rec_pkt, &amp;rec_err, &amp;rec_drop,
                                &amp;snd_oct, &amp;snd_pkt, &amp;snd_err, &amp;snd_drop,
                                &amp;coll);
        } else {
            scan_count = sscanf(stats, scan_line_to_use,
                                &amp;rec_pkt, &amp;rec_err,
                                &amp;snd_pkt, &amp;snd_err, &amp;coll);
        }
        if(scan_count&#160;!= scan_expected) {
            snmp_log(LOG_ERR,
                     "error scanning interface data (expected&#160;%d, got&#160;%d)\n",
                     scan_expected, scan_count);
            rc = MFD_ERROR;
            break;
        }
        if (scan_line_to_use&#160;!= scan_line_2_2) {
            rec_oct = rec_pkt * 308;
            snd_oct = snd_pkt * 308;
        }
</font>
        /*
         * TODO: populate data context
         */
        /*
         * TRANSIENT or semi-TRANSIENT data:
         * copy data or save any info needed to do it in row_prep.
         */
        /*
         * TODO: setup/save data for ifDescr
         * ifDescr(2)/DisplayString/ASN_OCTET_STR/char(char)//L/A/w/e/R/d/H
         */
    /** no mapping */<font color="blue">
        /** no code to get description yet */
        rowreq_ctx-&gt;data.ifDescr[0] = 0;
        rowreq_ctx-&gt;data.ifDescr_len = 0;
</font>
        /*
         * TODO: setup/save data for ifMtu
         * ifMtu(4)/INTEGER32/ASN_INTEGER/long(long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifMtu = TODO_FIND_ifMtu;
</font>
        /*
         * TODO: setup/save data for ifSpeed
         * ifSpeed(5)/GAUGE/ASN_GAUGE/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifSpeed = TODO_FIND_ifSpeed;
</font>
        /*
         * TODO: setup/save data for ifPhysAddress
         * ifPhysAddress(6)/PhysAddress/ASN_OCTET_STR/char(char)//L/A/w/e/r/d/H
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */
        /*
         * make sure there is enough space for data
         */<font color="blue">
        if (sizeof(rowreq_ctx-&gt;data.ifPhysAddress) &lt; 6) {
            snmp_log(LOG_ERR, "not enough space for address while loading "
                         "ifTable cache.\n");
            ifTable_release_rowreq_ctx(rowreq_ctx);
            continue;
        }
        rowreq_ctx-&gt;data.ifPhysAddress_len = 6;
        strncpy(ifrq.ifr_name, ifstart, sizeof(ifrq.ifr_name));
        ifrq.ifr_name[ sizeof(ifrq.ifr_name)-1 ] = 0;
        if (ioctl(fd, SIOCGIFHWADDR, &amp;ifrq) &lt; 0)
            memset(rowreq_ctx-&gt;data.ifPhysAddress, (0), 6);
        else {
            memcpy(rowreq_ctx-&gt;data.ifPhysAddress,
                   ifrq.ifr_hwaddr.sa_data, 6);
        }
</font>
        /*
         * TODO: setup/save data for ifType
         * ifType(3)/IANAifType/ASN_INTEGER/long(u_long)//l/A/w/E/r/d/h
         */
        /*
         * TODO:
         * value mapping
         */
        if (MFD_SUCCESS&#160;!=
            ifType_map(&amp;rowreq_ctx-&gt;data.ifType,
                       <font color="blue">ifrq.ifr_hwaddr.sa_family</font>)) {
            snmp_log(LOG_ERR, "error mapping ifType while loading "
                     "ifTable cache.\n");
            ifTable_release_rowreq_ctx(rowreq_ctx);
            continue;
        }

        /*
         * TODO: setup/save data for ifAdminStatus
         * ifAdminStatus(7)/INTEGER/ASN_INTEGER/long(u_long)//l/A/W/E/r/d/h
         */
        /*
         * TODO:
         * value mapping
         */

        /*
         * TODO: setup/save data for ifOperStatus
         * ifOperStatus(8)/INTEGER/ASN_INTEGER/long(u_long)//l/A/w/E/r/d/h
         */
        /*
         * TODO:
         * value mapping
         */

        /*
         * TODO: setup/save data for ifLastChange
         * ifLastChange(9)/TICKS/ASN_TIMETICKS/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifLastChange = TODO_FIND_ifLastChange;
</font>
        /*
         * TODO: setup/save data for ifInOctets
         * ifInOctets(10)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifInOctets = rec_oct;
</font>
        /*
         * TODO: setup/save data for ifInUcastPkts
         * ifInUcastPkts(11)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifInUcastPkts = rec_pkt;
</font>
        /*
         * TODO: setup/save data for ifInNUcastPkts
         * ifInNUcastPkts(12)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifInNUcastPkts = TODO_FIND_ifInNUcastPkts;
</font>
        /*
         * TODO: setup/save data for ifInDiscards
         * ifInDiscards(13)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifInDiscards = rec_drop;
</font>
        /*
         * TODO: setup/save data for ifInErrors
         * ifInErrors(14)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifInErrors = rec_err;
</font>
        /*
         * TODO: setup/save data for ifInUnknownProtos
         * ifInUnknownProtos(15)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifInUnknownProtos = TODO_FIND_ifInUnknownProtos;
</font>
        /*
         * TODO: setup/save data for ifOutOctets
         * ifOutOctets(16)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifOutOctets = snd_oct;
</font>
        /*
         * TODO: setup/save data for ifOutUcastPkts
         * ifOutUcastPkts(17)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifOutUcastPkts = snd_pkt;
</font>
        /*
         * TODO: setup/save data for ifOutNUcastPkts
         * ifOutNUcastPkts(18)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifOutNUcastPkts = TODO_FIND_ifOutNUcastPkts;
</font>
        /*
         * TODO: setup/save data for ifOutDiscards
         * ifOutDiscards(19)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifOutDiscards = snd_drop;
</font>
        /*
         * TODO: setup/save data for ifOutErrors
         * ifOutErrors(20)/COUNTER/ASN_COUNTER/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        rowreq_ctx-&gt;data.ifOutErrors = snd_err;
</font>
        /*
         * TODO: setup/save data for ifOutQLen
         * ifOutQLen(21)/GAUGE/ASN_GAUGE/u_long(u_long)//l/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */<font color="blue">
        //rowreq_ctx-&gt;data.ifOutQLen = TODO_FIND_ifOutQLen;
</font>
        /*
         * TODO: setup/save data for ifSpecific
         * ifSpecific(22)/OBJECTID/ASN_OBJECT_ID/oid(oid)//L/A/w/e/r/d/h
         */
    /** no mapping */
        /*
         * TODO:
         * update, replace or delete, if needed.
         */
        /*
         * make sure there is enough space for data
         */<font color="blue">
        /** not implemented */
</font>
        /*
         * insert into table container
         */
        CONTAINER_INSERT(container, rowreq_ctx);
    }
</pre>
<pre>    /*
     ***************************************************
     ***             START EXAMPLE CODE              ***
     ***---------------------------------------------***/<font color="blue">
    close(fd);</font>
    if (NULL&#160;!= filep)
        fclose(filep);
    /*
     ***---------------------------------------------***
     ***              END  EXAMPLE CODE              ***
     ***************************************************/
<font color="blue">return rc;</font>
</pre>
<p>}
</p>
</td>
</tr>
</table>
<h4><span class="mw-headline" id="Cache_Unload">Cache Unload</span></h4>
<p>When a cache has expired, the unload routine is called. The MFD
interface code calls the cache free routine to allow your handler
to do any necessary cleanup. Note that you should not actually
remove items from the container or delete anything - that will be
handled automaticaly by the container class.
</p>
<table><tr><td width="20"></td><td bgcolor="CCCCCC">
<pre>void
ifTable_cache_free(netsnmp_container * container)
{
    DEBUGMSGTL(("verbose:ifTable_cache_free", "called\n"));
}
</pre>
</td>
        </tr>
</table>
<p>In this simple example, we get most of our data from an external
file, so simply flushing the cache meets our needs. In later
tutorials, we'll see how to supress the cache unload/free and
re-use existing data.
</p><p><br />
The agent does runs a periodic check (the default is every 60
seconds, I believe) for expired caches, and will call the
unload routine for expired caches. See the documentation
page on the cache helper for ways to modify this behavior, if
you need to.
</p><p><br />
</p>
<h3><span class="mw-headline" id="Row_preparation">Row preparation</span></h3>
<p>The row preparation function <var>ifTable_row_prep</var> is common
to all data access methods. After the correct row request context
is found for a request, this routine will be called for each row
that is referenced in the incoming request. This gives you
one last chance to update the context before the request is processed.
</p><p>The primary purpose of the cache load
routine (for MFD tables) is to set up the indexes. In this case,
we have access to everything we need during cache loading, so we
set up all our data there. If some data needed to be retrieved
from another source, we could delay loading it until the row is
needed.
</p><p>Not, however, that while the cache load routine won't be called
again until the cache expires, the row prep routine is called
for each request. This is why we perform the ioctl to retrieve the
physical address (ifPhysAddr) during the cache load. If the ioctl
was for data that changed frequently, we could have chosen to
update that data here. That is an option if you don't mind having
a mix of cached data and fresh data.
</p><p>Since we have already done the processing we need to do, so we'll
just leave this function as is.
</p>
<table><tr><td width="20"></td><td bgcolor="CCCCCC">
<pre>int
ifTable_row_prep(ifTable_rowreq_ctx * rowreq_ctx)
{
    DEBUGMSGTL(("verbose:ifTable_row_prep", "called\n"));

    netsnmp_assert(NULL&#160;!= rowreq_ctx);
 

    return MFD_SUCCESS;
}
</pre>
</td>
</tr>
</table>

<!-- 
NewPP limit report
Cached time: 20171116102106
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.303 seconds
Real time usage: 0.333 seconds
Preprocessor visited node count: 83/1000000
Preprocessor generated node count: 140/1000000
Post‐expand include size: 770/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
-->

<!-- 
Transclusion expansion time report (%,ms,calls,template)
100.00%   18.637      1 - -total
100.00%   18.637      1 - Template:MFDTutorial
-->

<!-- Saved in parser cache with key n12694_wikidb:pcache:idhash:2239-0!*!0!!en!*!* and timestamp 20171116102105 and revision id 5246
 -->
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://net-snmp.sourceforge.net/wiki/index.php?title=MFD:ifTable:Data_Access&amp;oldid=5246">http://net-snmp.sourceforge.net/wiki/index.php?title=MFD:ifTable:Data_Access&amp;oldid=5246</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="MFD_ifTable_Data_Access.html" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="Talk_MFD_ifTable_Data_Access.html?title=Talk:MFD:ifTable:Data_Access&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource"><a href="../indexd73e.html?title=MFD:ifTable:Data_Access&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="../indexbfb1.html?title=MFD:ifTable:Data_Access&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="../index6982.html?title=Special:UserLogin&amp;returnto=MFD%3AifTable%3AData+Access&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="../index9322.html?title=Special:UserLogin&amp;returnto=MFD%3AifTable%3AData+Access" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="Main_Page.html" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-project" role="navigation">
		<h3>project</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Web-Site"><a href="../../index.html" rel="nofollow">Web Site</a></li>
											<li id="n-Wiki"><a href="Main_Page.html">Wiki</a></li>
											<li id="n-Download"><a href="../../download.html" rel="nofollow">download</a></li>
											<li id="n-Mailing-Lists"><a href="../../support/mailinglists.html" rel="nofollow">Mailing Lists</a></li>
											<li id="n-Bug-Reports"><a href="../../support/bugreports.html" rel="nofollow">Bug Reports</a></li>
											<li id="n-Patches"><a href="../../support/patches.html" rel="nofollow">Patches</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-documentation" role="navigation">
		<h3>documentation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Tutorials"><a href="Tutorials.html">Tutorials</a></li>
											<li id="n-FAQ"><a href="FAQ.html">FAQ</a></li>
											<li id="n-Good-Answers"><a href="Category_GoodAnswer.html">Good Answers</a></li>
											<li id="n-Manual-Pages"><a href="../../man/index.html" rel="nofollow">Manual Pages</a></li>
											<li id="n-Tools"><a href="Category_Tools.html">Tools</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-wiki" role="navigation">
		<h3>wiki</h3>
		<div class='pBody'>
							<ul>
											<li id="n-recentchanges"><a href="Special_RecentChanges.html" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="Notes20111219.html" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.net-snmp.org/wiki/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Net-SNMP Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="Special_WhatLinksHere/MFD_ifTable_Data_Access.html" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="Special_RecentChangesLinked/MFD_ifTable_Data_Access.html" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="Special_SpecialPages.html" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-print"><a href="../index8360.html?title=MFD:ifTable:Data_Access&amp;printable=yes" rel="alternate" title="Printable version of this page [p]" accesskey="p">Printable version</a></li>
											<li id="t-permalink"><a href="../index64d0.html?title=MFD:ifTable:Data_Access&amp;oldid=5246" title="Permanent link to this revision of the page">Permanent link</a></li>
											<li id="t-info"><a href="../index8b6b.html?title=MFD:ifTable:Data_Access&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="../resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="lastmod"> This page was last modified on 18 July 2011, at 23:45.</li>
									<li id="privacy"><a href="Net-SNMP_Wiki_Privacy_policy.html" title="Net-SNMP Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="Net-SNMP_Wiki_About.html" title="Net-SNMP Wiki:About">About Net-SNMP Wiki</a></li>
									<li id="disclaimer"><a href="Net-SNMP_Wiki_General_disclaimer.html" title="Net-SNMP Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.toc","mediawiki.action.view.postEdit","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":1656});
} );</script></body><!-- Cached 20171116102106 -->

<!-- Mirrored from www.net-snmp.org/wiki/index.php/MFD:ifTable:Data_Access by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 19:03:58 GMT -->
</html>
