

<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=TUT:snmptrap&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:21:56 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for TUT:snmptrap - Net-SNMP Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"TUT:snmptrap","wgTitle":"TUT:snmptrap","wgCurRevisionId":5114,"wgRevisionId":0,"wgArticleId":1736,"wgIsArticle":!1,"wgIsRedirect":!1,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":!0,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"TUT:snmptrap","wgRelevantArticleId":1736,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="load34a1.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="load3a95.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.26.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://www.net-snmp.org/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://www.net-snmp.org/wiki/opensearch_desc.php" title="Net-SNMP Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://www.net-snmp.org/wiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Net-SNMP Wiki Atom feed" href="http://www.net-snmp.org/wiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-TUT_snmptrap skin-monobook action-edit">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">View source for TUT:snmptrap</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Net-SNMP Wiki</div>
					<div id="contentSub">‚Üê <a href="http://www.net-snmp.org/wiki/index.php/TUT:snmptrap" title="TUT:snmptrap">TUT:snmptrap</a></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.net-snmp.org/wiki/index.php?title=Net-SNMP_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Net-SNMP Wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">Most SNMP traffic is sent from a management station to a network entity,
in order to find out about that system or adjust its configuration in
some way.  Notifications (Traps and Informs) can be used by a network
entity to signal abnormal conditions to a management station.

Typically, such a notification would normally be generated by an SNMP
agent, but this tutorial will concentrate on the &lt;code>[[snmptrap]]&lt;/code>
command, which can also be used to generate such traps.

== Trap Definitions ==

There are two ways of defining a notification - one used in SMIv1 MIBs
and one used in SMIv2 MIBs.  The two styles are basically equivalent,
and it is possible to convert between the two.  In particular, it is
perfectly valid to send an SMIv2-defined notification as an SNMPv1 trap,
or an SMIv1-defined trap as an SNMPv2c (or SNMPv3) notification.

=== SMIv1 Traps ===

A trap is defined in an SMIv1 MIB file using the TRAP-TYPE macro,
as in the following example:

  UCD-TRAP-TEST-MIB DEFINITIONS ::= BEGIN
        IMPORTS ucdExperimental FROM UCD-SNMP-MIB;
  
  demotraps OBJECT IDENTIFIER ::= { ucdExperimental 990 }
  
  '''demoTrap''' TRAP-TYPE
        '''ENTERPRISE demotraps'''
        VARIABLES { sysLocation }
        DESCRIPTION "An example of an SMIv1 trap"
        '''::= 17'''
  
  END

Note that the trap is identified by two values - the ''ENTERPRISE-oid'' (.1.3.6.1.4.1.2021.13.990 which is TRAP-TEST-MIB::demotraps)
and the ''specific-trap'' value of the TRAP-TYPE macro (17)

=== SMIv2 Notifications ===

A notification is defined in an SMIv2 MIB file using the NOTIFICATION-TYPE macro,
as in the following example:

  UCD-NOTIFICATION-TEST-MIB DEFINITIONS ::= BEGIN
        IMPORTS ucdExperimental FROM UCD-SNMP-MIB;
  
  ucdNotificationTestMib MODULE-IDENTITY
    ''-- omitted''
  
  demotraps  OBJECT IDENTIFIER ::= { ucdExperimental 990 }
  demonotifs OBJECT IDENTIFIER ::= { demotraps 0 }
  
  '''demoNotif''' NOTIFICATION-TYPE
        OBJECTS { sysLocation }
        STATUS current
        DESCRIPTION "An example of an SMIv2 notification"
        '''::= { demonotifs 18 }'''
  
  ucdNotificationGroup NOTIFICATION-GROUP
    ''-- omitted''
  END

Note that this defines a single OID which will uniquely identify
the notification.

=== Variables ===

Both SMIv1 and SMIv2 definitions can specify additional information
that should be included within the trap.
The name of the clause is different between the two definitions
(VARIABLES vs OBJECTS), but the meaning is the same - the
notification should include a varbind (OID and value) for each
object listed, in the order that they appear.

''&lt;tasks>[ ] Object vs Instance&lt;/tasks>''


=== Traps vs Notifications ===

Strictly speaking, we should probably refer to all such MIB definitions
as "notifications" - with the term "trap" being reserved for the
(unacknowledged) SNMP request used to transport the relevant information.
But people do tend to use the two terms interchangeably (as has been
the case in this tutorial as well!)

''&lt;tasks>[ ] describe {enterprises}.0.{value} &amp;lt;-&amp;gt; {oid} conversion&lt;/tasks>'' -- see [[TUT:Configuring snmptrapd#Trap_Handlers]]

== SNMP Traps ==

OK - so that describes how notifications are defined in a MIB file.
How are they represented as SNMP requests?

=== SNMPv1 Traps ===

Unsurprisingly, the format of a trap request follows the format of the
corresponding SMI definition fairly closely.  So an SNMPv1 trap should
contain two values - the enterprise OID and the value of the trap itself, right?

Wrong!  It actually contains ''three'' elements - an enterprise-OID and
''two'' trap values - a "generic-trap" field and a "specific-trap" field.
For traps defined in a custom MIB file (specific traps), the "generic-trap"
field will always have the value 6, and the "specific-trap" field will have
the value of the TRAP-TYPE macro. So the combined OID, identifying the trap will be

  enterprise-oid.0.specific-trap

For predefined (generic traps), "generic-trap" field will have a number 
identifying the trap, "specific-trap" value is irrelevant. Combined OID will be

  1.3.6.1.6.3.1.1.5.generic-trap+1

In fact, the SNMPv1 trap request actually contains five values - these
three plus the "agent" field (IP address of the system generating the trap, useful if you have
more than one network interface), and the
&lt;code>sysUpTime&lt;/code> of the generating application.

The &lt;code>snmptrap&lt;/code> command will use sensible defaults for
these two fields, so it's really just necessary to provide the
enterprise-OID and the two trap values, plus the payload of the trap itself [OID, type, value]:

  syntax:
  snmptrap -v 1 [COMMON OPTIONS] [-Ci] destination enterprise-oid agent generic-trap specific-trap uptime [OID TYPE VALUE]

   $ snmptrap -v 1 -c public host '''UCD-TRAP-TEST-MIB::demotraps''' "" '''6 17''' "" \
        SNMPv2-MIB::sysLocation.0 s "Just here"

Note that this command also includes an (OID,type,value) triple for the
varbinds listed in the VARIABLES clause (in the same way as with the
[[TUT:snmpset|snmpset]] command).

In case you don't have UCD-TRAP-TEST-MIB module defined (default installation on Redhat and Suse), you may try NET-SNMP-EXAMPLES-MIB module instead:

   $ snmptrap -v 1 -c public host '''NET-SNMP-EXAMPLES-MIB::netSnmpExampleHeartbeatNotification "" 6 17''' "" \
        netSnmpExampleHeartbeatRate i 123456
 
   $ snmptrap -v 1 -c public host '''NET-SNMP-EXAMPLES-MIB::netSnmpExampleNotification "" 6 17''' "" \
        netSnmpExampleInteger i 123456

More examples:

  $snmptrap -v 1 -c public host '1.2.3.4.5.6' '192.193.194.195' 6 99 '55' 1.11.12.13.14.15  s "teststring"

=== SNMPv2 Traps ===

SNMPv2 simplified the format of a notification request, consolidating
everything within the varbind list, rather than having separate header
fields just for Trap requests.  So the first two varbinds of an SNMPv2
notification will be &lt;code>sysUpTime.0&lt;/code> following by &lt;code>snmpTrapOID.0&lt;/code>.
The value of this second varbind is the OID identifying the trap being sent.

The &lt;code>snmptrap&lt;/code> command will insert a sensible value for
the sysUpTime varbind, so it's really just necessary to provide the
trap OID (plus any additional varbinds from the OBJECTS clause):

   $ snmptrap -v '''2c''' -c public host "" '''UCD-NOTIFICATION-TEST-MIB::demoNotif''' \
        SNMPv2-MIB::sysLocation.0 s "Just here"

In case you don't have UCD-TRAP-TEST-MIB module defined (default installation on Redhat and Suse), you may try NET-SNMP-EXAMPLES-MIB module instead:

   $ snmptrap -v '''2c''' -c public host "" '''NET-SNMP-EXAMPLES-MIB::netSnmpExampleHeartbeatNotification''' \
        netSnmpExampleHeartbeatRate i 123456

=== SNMPv2 Informs ===

''&lt;tasks>[ ] Similar to Traps, but acknowledged - i.e. resend if no response&lt;/tasks>''

=== SNMPv3 Notifications ===

''&lt;tasks>[ ] Same as SNMPv2, but v3 admin&lt;/tasks>''

== Agent Traps ==

The agent is able to generate a few traps by itself. When starting up, it will generate a SNMPv2-MIB::coldStart trap, and when shutting down a UCD-SNMP-MIB::ucdShutDown. 

These traps are sent to managers specified in the snmpd.conf file, using the trapsink or trap2sink directive (SNMPv1 and SNMPv2 trap respectively) 

  # send v1 traps
  trapsink        nms.system.com  public
  # also send v2 traps
  trap2sink       nms.system.com  secret
  # send traps on authentication failures
  authtrapenable  1

In addition, the agent is able to send authentication failure traps
to the same hosts as above, controlled by the authtrapenable directive
in snmpd.conf, or by setting the SNMPv2-MIB::snmpEnableAuthenTraps
variable

  $ '''snmpset -c public agent SNMPv2-MIB::snmpEnableAuthenTraps s enable'''


To perform various tasks when notifications arrive at the Net-SNMP [[snmptrapd]] notification receiver, please see the page on [[TUT:Configuring snmptrapd]]

&lt;hr>

{{TUT:LIST}}
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Template used on this page:
</p></div><ul>
<li><a href="http://www.net-snmp.org/wiki/index.php/Template:TUT:LIST" title="Template:TUT:LIST">Template:TUT:LIST</a> (<a href="http://www.net-snmp.org/wiki/index.php?title=Template:TUT:LIST&amp;action=edit" title="Template:TUT:LIST">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="http://www.net-snmp.org/wiki/index.php/TUT:snmptrap" title="TUT:snmptrap">TUT:snmptrap</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.net-snmp.org/wiki/index.php/TUT:snmptrap">http://www.net-snmp.org/wiki/index.php/TUT:snmptrap</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="http://www.net-snmp.org/wiki/index.php/TUT:snmptrap" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.net-snmp.org/wiki/index.php?title=Talk:TUT:snmptrap&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:snmptrap&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:snmptrap&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=TUT%3Asnmptrap&amp;returntoquery=action%3Dedit&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=TUT%3Asnmptrap&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="http://www.net-snmp.org/wiki/index.php/Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-project" role="navigation">
		<h3>project</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Web-Site"><a href="http://www.net-snmp.org/" rel="nofollow">Web Site</a></li>
											<li id="n-Wiki"><a href="http://www.net-snmp.org/wiki/index.php/Main_Page">Wiki</a></li>
											<li id="n-Download"><a href="http://www.net-snmp.org/download.html" rel="nofollow">download</a></li>
											<li id="n-Mailing-Lists"><a href="http://www.net-snmp.org/support/mailinglists.html" rel="nofollow">Mailing Lists</a></li>
											<li id="n-Bug-Reports"><a href="http://www.net-snmp.org/support/bugreports.html" rel="nofollow">Bug Reports</a></li>
											<li id="n-Patches"><a href="http://www.net-snmp.org/support/patches.html" rel="nofollow">Patches</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-documentation" role="navigation">
		<h3>documentation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Tutorials"><a href="http://www.net-snmp.org/wiki/index.php/Tutorials">Tutorials</a></li>
											<li id="n-FAQ"><a href="http://www.net-snmp.org/wiki/index.php/FAQ">FAQ</a></li>
											<li id="n-Good-Answers"><a href="http://www.net-snmp.org/wiki/index.php/Category:GoodAnswer">Good Answers</a></li>
											<li id="n-Manual-Pages"><a href="http://www.net-snmp.org/man" rel="nofollow">Manual Pages</a></li>
											<li id="n-Tools"><a href="http://www.net-snmp.org/wiki/index.php/Category:Tools">Tools</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-wiki" role="navigation">
		<h3>wiki</h3>
		<div class='pBody'>
							<ul>
											<li id="n-recentchanges"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="http://www.net-snmp.org/wiki/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.net-snmp.org/wiki/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Net-SNMP Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="http://www.net-snmp.org/wiki/index.php/Special:WhatLinksHere/TUT:snmptrap" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChangesLinked/TUT:snmptrap" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="http://www.net-snmp.org/wiki/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-info"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:snmptrap&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="http://www.net-snmp.org/wiki/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="privacy"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:Privacy_policy" title="Net-SNMP Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:About" title="Net-SNMP Wiki:About">About Net-SNMP Wiki</a></li>
									<li id="disclaimer"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:General_disclaimer" title="Net-SNMP Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":129});
} );</script></body>
<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=TUT:snmptrap&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:21:56 GMT -->
</html>
