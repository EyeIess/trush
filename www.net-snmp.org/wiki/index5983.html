

<!DOCTYPE html>
<html lang="en" dir="ltr" class="client-nojs">

<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=TUT:Using_TLS&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:22:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=UTF-8" /><!-- /Added by HTTrack -->
<head>
<meta charset="UTF-8" />
<title>View source for TUT:Using TLS - Net-SNMP Wiki</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":!1,"wgNamespaceNumber":0,"wgPageName":"TUT:Using_TLS","wgTitle":"TUT:Using TLS","wgCurRevisionId":4678,"wgRevisionId":0,"wgArticleId":2071,"wgIsArticle":!1,"wgIsRedirect":!1,"wgAction":"edit","wgUserName":null,"wgUserGroups":["*"],"wgCategories":[],"wgBreakFrames":!0,"wgPageContentLanguage":"en","wgPageContentModel":"wikitext","wgSeparatorTransformTable":["",""],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","January","February","March","April","May","June","July","August","September","October","November","December"],"wgMonthNamesShort":["","Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wgRelevantPageName":"TUT:Using_TLS","wgRelevantArticleId":2071,"wgIsProbablyEditable":!1,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.implement("user.options",function($,jQuery){mw.user.options.set({"variant":"en"});});mw.loader.implement("user.tokens",function($,jQuery){mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\"});});mw.loader.load(["mediawiki.page.startup","mediawiki.legacy.wikibits"]);
} );</script>
<link rel="stylesheet" href="load34a1.css?debug=false&amp;lang=en&amp;modules=mediawiki.legacy.commonPrint%2Cshared%7Cmediawiki.sectionAnchor%7Cmediawiki.skinning.content.externallinks%7Cmediawiki.skinning.interface%7Cskins.monobook.styles&amp;only=styles&amp;skin=monobook" />
<!--[if IE 6]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE60Fixes.css?303" media="screen" /><![endif]-->
<!--[if IE 7]><link rel="stylesheet" href="/wiki/skins/MonoBook/IE70Fixes.css?303" media="screen" /><![endif]-->
<meta name="ResourceLoaderDynamicStyles" content="" />
<style>a:lang(ar),a:lang(kk-arab),a:lang(mzn),a:lang(ps),a:lang(ur){text-decoration:none}</style>
<script async="" src="load3a95.php?debug=false&amp;lang=en&amp;modules=startup&amp;only=scripts&amp;skin=monobook"></script>
<meta name="generator" content="MediaWiki 1.26.3" />
<meta name="robots" content="noindex,nofollow" />
<link rel="shortcut icon" href="http://www.net-snmp.org/favicon.ico" />
<link rel="search" type="application/opensearchdescription+xml" href="http://www.net-snmp.org/wiki/opensearch_desc.php" title="Net-SNMP Wiki (en)" />
<link rel="EditURI" type="application/rsd+xml" href="http://www.net-snmp.org/wiki/api.php?action=rsd" />
<link rel="alternate" type="application/atom+xml" title="Net-SNMP Wiki Atom feed" href="http://www.net-snmp.org/wiki/index.php?title=Special:RecentChanges&amp;feed=atom" />
</head>
<body class="mediawiki ltr sitedir-ltr ns-0 ns-subject page-TUT_Using_TLS skin-monobook action-edit">
<div id="globalWrapper">
		<div id="column-content">
			<div id="content" class="mw-body" role="main">
				<a id="top"></a>
				
				<div class="mw-indicators">
</div>
				<h1 id="firstHeading" class="firstHeading" lang="en">View source for TUT:Using TLS</h1>
				
				<div id="bodyContent" class="mw-body-content">
					<div id="siteSub">From Net-SNMP Wiki</div>
					<div id="contentSub">‚Üê <a href="http://www.net-snmp.org/wiki/index.php/TUT:Using_TLS" title="TUT:Using TLS">TUT:Using TLS</a></div>
										<div id="jump-to-nav" class="mw-jump">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>

					<!-- start content -->
					<div id="mw-content-text"><p>You do not have permission to edit this page, for the following reason:
</p>
<div class="permissions-errors">
<p>The action you have requested is limited to users in the group: <a href="http://www.net-snmp.org/wiki/index.php?title=Net-SNMP_Wiki:Users&amp;action=edit&amp;redlink=1" class="new" title="Net-SNMP Wiki:Users (page does not exist)">Users</a>.
</p>
</div>
<hr />
<p>You can view and copy the source of this page.
</p><textarea readonly="" accesskey="," id="wpTextbox1" cols="80" rows="25" style="" lang="en" dir="ltr" name="wpTextbox1">{{require|5.6}}

"SNMP over DTLS over UDP" and "SNMP over TLS over TCP" ([[rfc:5953|RFC5953]]) are supported in Net-SNMP 5.6 and beyond. This page describes how
to use [[DTLS]] or [[TLS]] for the end user. For information on the administering and configuring the agent with DTLS/TLS support,
see [[Using_DTLS]].

TLS and DTLS make use of the [[TSM|Transport Security Model (TSM)]] security model, defined in [[RFC:5591|RFC5591]] which was created as an alternative to the [[USM]] security model (which is discussed in the [[TUT:SNMPv3 Options|SNMPv3 Options tutorial]].

== DTLS vs TLS ==

[[TLS]] and [[DTLS]] are both protocols that protect packets in transit.  The first runs over [[TCP]] porto 10161 and the second over [[UDP]] port 10161, which both have unique advantages (and a discussion of those advantages is beyond scope of this tutorial).  

Below you'll find examples that use both the ''dtlsudp:'' prefix and the ''tlstcp:'' prefix.  Our ''test.net-snmp.org'' server will respond to both transports so you can try them both out.

== Required Build Options ==

You must have added these options when configure was run to make the following tutorial work:

  --with-security-modules=tsm --with-transports="DTLSUDP TLSTCP"

== Zero-config Example ==

=== Importing the tutorial certificates ===

You must download and install the certificates you will use to connect to the agent
(tutorial-joecool), the certificate that the agent will present for verification
(tutorial-agent) and the certificate authority that signed the agent's certificate
(tutorial-CA). The net-snmp-cert utility can import the certificate and put them
in the proper locations for you.

 $ '''net-snmp-cert -t tutorial-joecool import''' \
      '''http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-joecool.crt''' \
      '''http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-joecool.key'''
 
 $ '''net-snmp-cert -t tutorial-agent import''' \
       '''http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-agent.crt'''
 
 $ '''net-snmp-cert -t tutorial-CA import''' \
       '''http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-CA.crt'''

=== Querying the Net-SNMP test server ===

In these examples, ''test.net-snmp.org'' is the host name of the agent to query, using version 3 of the SNMP protocol and the transport security model, and an authPriv message protected a dtls connection using the certificates identified by the given certificate tags.  The OID being requested is &lt;tt>sysUpTime.0&lt;/tt> from the MIB module &lt;tt>SNMPv2-MIB&lt;/tt>.

First we directly specify both our identity and the identity we expect the agent to present:

 $ '''snmpget -T our_identity=tutorial-joecool''' \
           '''-T their_identity=tutorial-agent''' \
           '''-t 10 tls:test.net-snmp.org sysUpTime.0'''

You can also specify a trusted certificate authority (CA) for the agent, instead of a specific certificate:

 $ '''snmpget -T our_identity=tutorial-joecool''' \
           '''-T trust_cert=tutorial-CA''' \
           '''-t 10 tls:test.net-snmp.org sysUpTime.0'''

Once you add certificate options to your configuration files, you no longer need to specify
certificate on the command line:

 $ '''echo trustCert tutorial-CA >> $HOME/.snmp/snmp.conf'''
 $ '''echo clientCert tutorial-joecool >> $HOME/.snmp/snmp.conf'''
 
 $ '''snmpget -t 10 tls:test.net-snmp.org sysUpTime.0'''

== Obtaining and using test.net-snmp.org certificates ==

You will need the certificates for the Net-SNMP test server and test user for this tutorial. A compressed tarball is avaialable [http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-.snmp.tar.gz here], along with its [http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-.snmp.tar.gz.asc gpg signature].  Or you can download the individual files as well:

{| style="margin-left: 2em;"
|-
| complete tar.gz
| http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-.snmp.tar.gz
|-
| User tutorial
| http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-joecool.crt
|-
| User private key
| http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-joecool.crt
|-
| CA certificate
| http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-CA.crt
|-
| Agent certificate
| http://www.net-snmp.org/tutorial/tutorial-5/certificates/tutorial-agent.crt
|-
|}

The net-snmp-cert command is able to pull these certificates directly from a URL, as shown in the previous example.

=== Extracting the tarball ===

If you retrieved the entire certificate tar-ball, extract it as follows:

Once you have the &lt;tt>tutorial-.snmp&lt;/tt> tarball, uncompress it in your home directory:

 $ tar xvfz tutorial-.snmp.tar.gz
 
 .snmp/
 .snmp/snmp.conf.tutorial
 .snmp/tls/
 .snmp/tls/newcerts/
 .snmp/tls/private/
 .snmp/tls/private/tutorial-joecool.key
 .snmp/tls/ca-certs/
 .snmp/tls/ca-certs/tutorial-CA.crt
 .snmp/tls/certs/
 .snmp/tls/certs/tutorial-joecool.crt
 .snmp/tls/certs/tutorial-agent.crt

You can use net-snmp-cert to show you the certificates (and their fingerprints):

 $ net-snmp-cert showcert
 /home/dummy/.snmp/tls:
 
 certs/tutorial-agent.crt:
 subject= /C=US/ST=California/O=Net-SNMP Developers/OU=SNMP-TLS/CN=tutorial-agent/emailAddress=tutorial-agent@test.net-snmp.org
 
 
 certs/tutorial-joecool.crt:
 subject= /C=US/ST=California/O=Net-SNMP Developers/OU=SNMP-TLS/CN=Joe Cool/emailAddress=joe.cool@test.net-snmp.org

 $ net-snmp-cert showcert --fingerprint
 /home/dummy/.snmp/tls:
 
 certs/tutorial-agent.crt:
 SHA1 Fingerprint=CA:B8:0A:B3:6B:4C:21:2A:F2:92:CD:0B:6B:DF:6A:9F:23:D6:30:4B
 
 
 certs/tutorial-joecool.crt:
 SHA1 Fingerprint=CD:74:45:C9:A3:A3:55:0A:6C:37:03:B2:49:38:B1:01:99:95:8E:43

=== Querying the demo agent ===

==== Querying using filenames for keys ====

Now that you have the certificates, you can query the test agent using the file names:

 snmpget -T our_identity=tutorial-joecool \
         -T their_identity=tutorial-agent \
         tlstcp:test.net-snmp.org sysContact.0

==== Querying using fingerprints for keys ====
or the fingerprints:

 snmpget -T our_identity=CD:74:45:C9:A3:A3:55:0A:6C:37:03:B2:49:38:B1:01:99:95:8E:43 \
         -T their_identity=CA:B8:0A:B3:6B:4C:21:2A:F2:92:CD:0B:6B:DF:6A:9F:23:D6:30:4B \
         tls:test.net-snmp.org sysContact.0

==== Querying using a trusted CA certificate and their properly encoded hostname ====

You can also specify that you trust the host CA and expect the remote certificate to have it's host name in its certificate file that matches your command line:

 snmpget -T our_identity=tutorial-joecool \
         -T trustCert=tutorial-CA \
         tlstcp:test.net-snmp.org sysContact.0

(this won't work if their presented certificate doesn't contain "test.net-snmp.org")

==== Setting up configuration ====

Those are long ugly command lines, so you might want to add some defaults in your configuration file, snmp.conf.
There is an included snmp.conf file, but to ensure that we don't overwrite any existing snmp.conf it
must be appended to your existing configuration file.

 $ cat $HOME/.snmp/snmp.conf.tutorial >> $HOME/.snmp/snmp.conf

Now try this much simpler query:

 $ snmpget tls:test.net-snmp.org sysContact.0
 SNMPv2-MIB::sysContact.0 = STRING: Net-SNMP Coders &lt;net-snmp-coders@lists.sourceforge.net>

== Getting tutorial certificates into a Java Keystore ==
If you need to use a Java client for testing, you have to jump through a few hoops
to get Java to use the tutorial certificates.

=== Public Certificates ===
Importing certificates is pretty easy.
 keytool -import -keystore net-snmp.jks -alias tutorial-ca -file ca-certs/tutorial-CA.crt

Keytool doesn't like the text expansion of the certificate, so copy the agent certificate and delete everything before '-----BEGIN CERTIFICATE-----'.
 cp certs/tutorial-agent.crt /tmp/tutorial-agent.crt
 vi /tmp/tutorial-agent.crt
 keytool -import -keystore net-snmp.jks -alias tutorial-agent -file /tmp/tutorial-agent.crt

=== Private Keys ===
Private keys, not so easy.

First convert them to DER:
 openssl x509 -in certs/tutorial-joecool.crt -inform PEM -out joecool-cert.der -outform DER
 openssl pkcs8 -topk8 -nocrypt -in private/tutorial-joecool.key -inform PEM -out joecool-key.der -outform DER

Java's keytool can't import private keys, so we have to rely on the kindness of strangers. In this case, Neal Groothuis. Head over to http://www.nealgroothuis.name/import-a-private-key-into-a-java-keystore/ and cut-and-paste his KeyStoreImport.java code to a local file.
'''WARNING: KeyStoreImport will echo your password!'''
 javac KeyStoreImport.java
 java KeyStoreImport net-snmp.jks joecool-cert.der  joecool-key.der  joecool

Check your work:
 keytool -list -keystore net-snmp.jks

&lt;hr>

{{TUT:LIST}}
</textarea><div class="templatesUsed"><div class="mw-templatesUsedExplanation"><p>Templates used on this page:
</p></div><ul>
<li><a href="http://www.net-snmp.org/wiki/index.php/Template:Require" title="Template:Require">Template:Require</a> (<a href="http://www.net-snmp.org/wiki/index.php?title=Template:Require&amp;action=edit" title="Template:Require">view source</a>) </li><li><a href="http://www.net-snmp.org/wiki/index.php/Template:TUT:LIST" title="Template:TUT:LIST">Template:TUT:LIST</a> (<a href="http://www.net-snmp.org/wiki/index.php?title=Template:TUT:LIST&amp;action=edit" title="Template:TUT:LIST">view source</a>) </li></ul></div><p id="mw-returnto">Return to <a href="http://www.net-snmp.org/wiki/index.php/TUT:Using_TLS" title="TUT:Using TLS">TUT:Using TLS</a>.</p>
</div><div class="printfooter">
Retrieved from "<a dir="ltr" href="http://www.net-snmp.org/wiki/index.php/TUT:Using_TLS">http://www.net-snmp.org/wiki/index.php/TUT:Using_TLS</a>"</div>
					<div id='catlinks' class='catlinks catlinks-allhidden'></div>					<!-- end content -->
										<div class="visualClear"></div>
				</div>
			</div>
		</div>
		<div id="column-one">
			<h2>Navigation menu</h2>
					<div id="p-cactions" class="portlet" role="navigation">
			<h3>Views</h3>

			<div class="pBody">
				<ul>
				<li id="ca-nstab-main" class="selected"><a href="http://www.net-snmp.org/wiki/index.php/TUT:Using_TLS" title="View the content page [c]" accesskey="c">Page</a></li>
				<li id="ca-talk" class="new"><a href="http://www.net-snmp.org/wiki/index.php?title=Talk:TUT:Using_TLS&amp;action=edit&amp;redlink=1" rel="discussion" title="Discussion about the content page [t]" accesskey="t">Discussion</a></li>
				<li id="ca-viewsource" class="selected"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:Using_TLS&amp;action=edit" title="This page is protected.&#10;You can view its source [e]" accesskey="e">View source</a></li>
				<li id="ca-history"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:Using_TLS&amp;action=history" title="Past revisions of this page [h]" accesskey="h">History</a></li>
				</ul>
							</div>
		</div>
				<div class="portlet" id="p-personal" role="navigation">
				<h3>Personal tools</h3>

				<div class="pBody">
					<ul>
													<li id="pt-createaccount"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=TUT%3AUsing+TLS&amp;returntoquery=action%3Dedit&amp;type=signup" title="You are encouraged to create an account and log in; however, it is not mandatory">Create account</a></li>
													<li id="pt-login"><a href="http://www.net-snmp.org/wiki/index.php?title=Special:UserLogin&amp;returnto=TUT%3AUsing+TLS&amp;returntoquery=action%3Dedit" title="You are encouraged to log in; however, it is not mandatory [o]" accesskey="o">Log in</a></li>
											</ul>
				</div>
			</div>
			<div class="portlet" id="p-logo" role="banner">
				<a href="http://www.net-snmp.org/wiki/index.php/Main_Page" class="mw-wiki-logo" title="Visit the main page"></a>
			</div>
				<div class="generated-sidebar portlet" id="p-project" role="navigation">
		<h3>project</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Web-Site"><a href="http://www.net-snmp.org/" rel="nofollow">Web Site</a></li>
											<li id="n-Wiki"><a href="http://www.net-snmp.org/wiki/index.php/Main_Page">Wiki</a></li>
											<li id="n-Download"><a href="http://www.net-snmp.org/download.html" rel="nofollow">download</a></li>
											<li id="n-Mailing-Lists"><a href="http://www.net-snmp.org/support/mailinglists.html" rel="nofollow">Mailing Lists</a></li>
											<li id="n-Bug-Reports"><a href="http://www.net-snmp.org/support/bugreports.html" rel="nofollow">Bug Reports</a></li>
											<li id="n-Patches"><a href="http://www.net-snmp.org/support/patches.html" rel="nofollow">Patches</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-documentation" role="navigation">
		<h3>documentation</h3>
		<div class='pBody'>
							<ul>
											<li id="n-Tutorials"><a href="http://www.net-snmp.org/wiki/index.php/Tutorials">Tutorials</a></li>
											<li id="n-FAQ"><a href="http://www.net-snmp.org/wiki/index.php/FAQ">FAQ</a></li>
											<li id="n-Good-Answers"><a href="http://www.net-snmp.org/wiki/index.php/Category:GoodAnswer">Good Answers</a></li>
											<li id="n-Manual-Pages"><a href="http://www.net-snmp.org/man" rel="nofollow">Manual Pages</a></li>
											<li id="n-Tools"><a href="http://www.net-snmp.org/wiki/index.php/Category:Tools">Tools</a></li>
									</ul>
					</div>
		</div>
		<div class="generated-sidebar portlet" id="p-wiki" role="navigation">
		<h3>wiki</h3>
		<div class='pBody'>
							<ul>
											<li id="n-recentchanges"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChanges" title="A list of recent changes in the wiki [r]" accesskey="r">Recent changes</a></li>
											<li id="n-randompage"><a href="http://www.net-snmp.org/wiki/index.php/Special:Random" title="Load a random page [x]" accesskey="x">Random page</a></li>
											<li id="n-help"><a href="https://www.mediawiki.org/wiki/Special:MyLanguage/Help:Contents" title="The place to find out">Help</a></li>
									</ul>
					</div>
		</div>
			<div id="p-search" class="portlet" role="search">
			<h3><label for="searchInput">Search</label></h3>

			<div id="searchBody" class="pBody">
				<form action="http://www.net-snmp.org/wiki/index.php" id="searchform">
					<input type='hidden' name="title" value="Special:Search"/>
					<input type="search" name="search" placeholder="Search" title="Search Net-SNMP Wiki [f]" accesskey="f" id="searchInput" />
					<input type="submit" name="go" value="Go" title="Go to a page with this exact name if it exists" id="searchGoButton" class="searchButton" />&#160;
						<input type="submit" name="fulltext" value="Search" title="Search the pages for this text" id="mw-searchButton" class="searchButton" />
				</form>

							</div>
		</div>
			<div class="portlet" id="p-tb" role="navigation">
			<h3>Tools</h3>

			<div class="pBody">
				<ul>
											<li id="t-whatlinkshere"><a href="http://www.net-snmp.org/wiki/index.php/Special:WhatLinksHere/TUT:Using_TLS" title="A list of all wiki pages that link here [j]" accesskey="j">What links here</a></li>
											<li id="t-recentchangeslinked"><a href="http://www.net-snmp.org/wiki/index.php/Special:RecentChangesLinked/TUT:Using_TLS" title="Recent changes in pages linked from this page [k]" accesskey="k">Related changes</a></li>
											<li id="t-specialpages"><a href="http://www.net-snmp.org/wiki/index.php/Special:SpecialPages" title="A list of all special pages [q]" accesskey="q">Special pages</a></li>
											<li id="t-info"><a href="http://www.net-snmp.org/wiki/index.php?title=TUT:Using_TLS&amp;action=info" title="More information about this page">Page information</a></li>
									</ul>
							</div>
		</div>
			</div><!-- end of the left (by default at least) column -->
		<div class="visualClear"></div>
					<div id="footer" role="contentinfo">
						<div id="f-poweredbyico">
									<a href="http://www.mediawiki.org/"><img src="http://www.net-snmp.org/wiki/resources/assets/poweredby_mediawiki_88x31.png" alt="Powered by MediaWiki" srcset="/wiki/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /wiki/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31" /></a>
							</div>
					<ul id="f-list">
									<li id="privacy"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:Privacy_policy" title="Net-SNMP Wiki:Privacy policy">Privacy policy</a></li>
									<li id="about"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:About" title="Net-SNMP Wiki:About">About Net-SNMP Wiki</a></li>
									<li id="disclaimer"><a href="http://www.net-snmp.org/wiki/index.php/Net-SNMP_Wiki:General_disclaimer" title="Net-SNMP Wiki:General disclaimer">Disclaimers</a></li>
							</ul>
		</div>
		</div>
		<script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.loader.state({"user":"ready","user.groups":"ready"});mw.loader.load(["mediawiki.action.edit.collapsibleFooter","site","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.searchSuggest"]);
} );</script><script>window.RLQ = window.RLQ || []; window.RLQ.push( function () {
mw.config.set({"wgBackendResponseTime":138});
} );</script></body>
<!-- Mirrored from www.net-snmp.org/wiki/index.php?title=TUT:Using_TLS&action=edit by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 14 May 2024 18:22:40 GMT -->
</html>
